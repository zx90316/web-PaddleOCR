# æ‰¹æ¬¡ä»»å‹™è™•ç†ç‹€æ…‹æŸ¥çœ‹åŠŸèƒ½èªªæ˜

## ğŸ¯ æ–°å¢åŠŸèƒ½

ç¾åœ¨æ‚¨å¯ä»¥åœ¨æ‰¹æ¬¡ä»»å‹™ç®¡ç†ç³»çµ±ä¸­æŸ¥çœ‹ç¬¬ä¸€éšæ®µå’Œç¬¬äºŒéšæ®µçš„è™•ç†ç‹€æ…‹ï¼ŒåŒ…æ‹¬ï¼š

1. âœ… **åŒ¹é…é é¢åœ–ç‰‡é è¦½** - æŸ¥çœ‹ CLIP æ‰¾åˆ°çš„æœ€ç›¸ä¼¼é é¢
2. âœ… **æª”æ¡ˆåˆ—è¡¨** - æŸ¥çœ‹æ‰€æœ‰æª”æ¡ˆçš„è™•ç†ç‹€æ…‹
3. âœ… **OCR çµæœé è¦½** - æŸ¥çœ‹æå–çš„é—œéµå­—å’Œè­˜åˆ¥çµæœ
4. âœ… **å…¨è¢å¹•åœ–ç‰‡æŸ¥çœ‹** - é»æ“Šåœ–ç‰‡æ”¾å¤§æŸ¥çœ‹è©³æƒ…

## ğŸ“± ä½¿ç”¨æ–¹å¼

### æ–¹å¼ä¸€ï¼šå¾ä»»å‹™åˆ—è¡¨é€²å…¥è©³æƒ…é 

1. è¨ªå•æ‰¹æ¬¡ä»»å‹™ç®¡ç†é é¢
   ```
   http://localhost:8080/batch-tasks
   ```

2. é»æ“Šä»»å‹™å¡ç‰‡é¸æ“‡è¦æŸ¥çœ‹çš„ä»»å‹™

3. åœ¨ä»»å‹™è©³æƒ…å€åŸŸï¼Œé»æ“Šã€ŒğŸ“Š æŸ¥çœ‹è©³æƒ…ã€æŒ‰éˆ•

4. ç³»çµ±æœƒåœ¨æ–°åˆ†é é–‹å•Ÿä»»å‹™è©³æƒ…é é¢

### æ–¹å¼äºŒï¼šç›´æ¥è¨ªå•ä»»å‹™è©³æƒ…é 

è¨ªå• URLï¼ˆæ›¿æ› `{task_id}` ç‚ºå¯¦éš›çš„ä»»å‹™ IDï¼‰ï¼š
```
http://localhost:8080/batch-tasks/{task_id}/detail
```

## ğŸ–¼ï¸ åŠŸèƒ½èªªæ˜

### 1. åœ–ç‰‡é è¦½æ¨™ç±¤é 

**é¡¯ç¤ºå…§å®¹**:
- æ‰€æœ‰å·²å®Œæˆç¬¬ä¸€éšæ®µè™•ç†çš„æª”æ¡ˆ
- æ¯å€‹æª”æ¡ˆçš„åŒ¹é…é é¢ç¸®åœ–
- åŒ¹é…é ç¢¼å’ŒåŒ¹é…åˆ†æ•¸

**æ“ä½œ**:
- é»æ“Šä»»ä½•åœ–ç‰‡æŸ¥çœ‹å¤§åœ–
- è‡ªå‹•è¼‰å…¥å‰ 12 å€‹æª”æ¡ˆ
- æ”¯æ´åˆ†é ç€è¦½

**åœ–ç‰‡è³‡è¨Š**:
- æª”æ¡ˆåç¨±
- åŒ¹é…åˆ°çš„é ç¢¼ï¼ˆä¾‹å¦‚ï¼šç¬¬ 5 é ï¼‰
- åŒ¹é…åˆ†æ•¸ï¼ˆ0-1 ä¹‹é–“ï¼Œè¶Šé«˜è¶Šç›¸ä¼¼ï¼‰

### 2. æª”æ¡ˆåˆ—è¡¨æ¨™ç±¤é 

**é¡¯ç¤ºå…§å®¹**:
- æ‰€æœ‰æª”æ¡ˆçš„å®Œæ•´åˆ—è¡¨
- æ¯å€‹æª”æ¡ˆçš„è™•ç†ç‹€æ…‹
- ç¬¬ä¸€éšæ®µå’Œç¬¬äºŒéšæ®µçš„ç‹€æ…‹

**è¡¨æ ¼æ¬„ä½**:
- æª”æ¡ˆåç¨±
- åŒ¹é…é é¢
- åŒ¹é…åˆ†æ•¸
- ç¬¬ä¸€éšæ®µç‹€æ…‹ï¼ˆpending/completed/failedï¼‰
- ç¬¬äºŒéšæ®µç‹€æ…‹ï¼ˆpending/completed/failedï¼‰
- æ“ä½œï¼ˆæŸ¥çœ‹åœ–ç‰‡æŒ‰éˆ•ï¼‰

### 3. OCR çµæœæ¨™ç±¤é 

**é¡¯ç¤ºå…§å®¹**:
- å·²å®Œæˆç¬¬äºŒéšæ®µè™•ç†çš„æª”æ¡ˆ
- æå–çš„é—œéµå­—å’Œå°æ‡‰çš„å€¼
- OCR è­˜åˆ¥çš„å®Œæ•´è³‡è¨Š

**æ¯å€‹çµæœåŒ…å«**:
- æª”æ¡ˆåç¨±
- åŒ¹é…é é¢å’Œåˆ†æ•¸
- æ‰€æœ‰é…ç½®çš„é—œéµå­—åŠå…¶æå–å€¼
- æŸ¥çœ‹åŸåœ–æŒ‰éˆ•

## ğŸ” åœ–ç‰‡æŸ¥çœ‹å™¨

é»æ“Šä»»ä½•åœ–ç‰‡å¾Œæœƒé–‹å•Ÿå…¨è¢å¹•æŸ¥çœ‹å™¨ï¼š

**é¡¯ç¤ºè³‡è¨Š**:
- å¤§å°ºå¯¸çš„åŒ¹é…é é¢åœ–ç‰‡
- æª”æ¡ˆåç¨±å’Œå®Œæ•´è·¯å¾‘
- åŒ¹é…é é¢ç·¨è™Ÿ
- åŒ¹é…åˆ†æ•¸ï¼ˆ4 ä½å°æ•¸ï¼‰
- ç¬¬ä¸€éšæ®µå’Œç¬¬äºŒéšæ®µç‹€æ…‹
- æå–çš„é—œéµå­—ï¼ˆå¦‚æœç¬¬äºŒéšæ®µå·²å®Œæˆï¼‰

**æ“ä½œ**:
- é»æ“Š âœ• æŒ‰éˆ•æˆ–æŒ‰ ESC éµé—œé–‰
- é»æ“ŠèƒŒæ™¯å€åŸŸé—œé–‰
- åœ–ç‰‡è‡ªå‹•é©æ‡‰è¢å¹•å¤§å°

## ğŸ“Š çµ±è¨ˆè³‡è¨Š

è©³æƒ…é é ‚éƒ¨é¡¯ç¤ºä»»å‹™çµ±è¨ˆï¼š

| çµ±è¨ˆé …ç›® | èªªæ˜ |
|---------|------|
| ç¸½æª”æ¡ˆæ•¸ | ä»»å‹™ä¸­çš„ PDF ç¸½æ•¸ |
| ç¬¬ä¸€éšæ®µå®Œæˆ | å·²å®Œæˆ CLIP åŒ¹é…çš„æª”æ¡ˆæ•¸ |
| ç¬¬äºŒéšæ®µå®Œæˆ | å·²å®Œæˆ OCR è­˜åˆ¥çš„æª”æ¡ˆæ•¸ |
| å¹³å‡åŒ¹é…åˆ†æ•¸ | æ‰€æœ‰æª”æ¡ˆçš„åŒ¹é…åˆ†æ•¸å¹³å‡å€¼ |

## ğŸ¨ ç•Œé¢ç‰¹è‰²

### éŸ¿æ‡‰å¼è¨­è¨ˆ
- è‡ªå‹•é©æ‡‰ä¸åŒè¢å¹•å°ºå¯¸
- ç¶²æ ¼å¸ƒå±€è‡ªå‹•èª¿æ•´
- ç§»å‹•è¨­å‚™å‹å¥½

### è¦–è¦ºåé¥‹
- æ‡¸åœæ•ˆæœï¼šå¡ç‰‡æœƒå‡èµ·ä¸¦é¡¯ç¤ºé™°å½±
- è¼‰å…¥ç‹€æ…‹ï¼šé¡¯ç¤ºè¼‰å…¥å‹•ç•«
- éŒ¯èª¤è™•ç†ï¼šåœ–ç‰‡è¼‰å…¥å¤±æ•—æ™‚é¡¯ç¤ºä½”ä½ç¬¦

### ä¾¿æ·æ“ä½œ
- åˆ†é åˆ‡æ›ï¼šé»æ“Šæ¨™ç±¤å¿«é€Ÿåˆ‡æ›
- æ‡¶è¼‰å…¥ï¼šæŒ‰éœ€è¼‰å…¥è³‡æ–™
- å¿«é€Ÿé è¦½ï¼šç¸®åœ–ç¶²æ ¼ä¸€ç›®äº†ç„¶

## ğŸš€ ä½¿ç”¨å ´æ™¯

### å ´æ™¯ 1ï¼šé©—è­‰ç¬¬ä¸€éšæ®µçµæœ

**ç›®çš„**: ç¢ºèª CLIP æ˜¯å¦æ­£ç¢ºæ‰¾åˆ°ç›®æ¨™é é¢

**æ­¥é©Ÿ**:
1. é€²å…¥ä»»å‹™è©³æƒ…é 
2. æŸ¥çœ‹ã€Œåœ–ç‰‡é è¦½ã€æ¨™ç±¤
3. æª¢æŸ¥æ¯å€‹æª”æ¡ˆçš„åŒ¹é…é é¢
4. ç¢ºèªåŒ¹é…åˆ†æ•¸æ˜¯å¦åˆç†ï¼ˆå»ºè­° > 0.7ï¼‰

**å¦‚æœçµæœä¸ç†æƒ³**:
- èª¿æ•´æ­£ä¾‹/åä¾‹é–¾å€¼
- ä½¿ç”¨æ›´æ¸…æ™°çš„ç¯„æœ¬åœ–ç‰‡
- é‡æ–°åŸ·è¡Œç¬¬ä¸€éšæ®µ

### å ´æ™¯ 2ï¼šæª¢æŸ¥è™•ç†é€²åº¦

**ç›®çš„**: äº†è§£ä»»å‹™è™•ç†åˆ°å“ªå€‹éšæ®µ

**æ­¥é©Ÿ**:
1. é€²å…¥ä»»å‹™è©³æƒ…é 
2. æŸ¥çœ‹çµ±è¨ˆè³‡è¨Š
3. åˆ‡æ›åˆ°ã€Œæª”æ¡ˆåˆ—è¡¨ã€æ¨™ç±¤
4. æŸ¥çœ‹æ¯å€‹æª”æ¡ˆçš„ç‹€æ…‹

**ç‹€æ…‹èªªæ˜**:
- `pending`: å¾…è™•ç†
- `completed`: å·²å®Œæˆ
- `failed`: è™•ç†å¤±æ•—

### å ´æ™¯ 3ï¼šé©—è­‰ OCR çµæœ

**ç›®çš„**: ç¢ºèªé—œéµå­—æ˜¯å¦æ­£ç¢ºæå–

**æ­¥é©Ÿ**:
1. é€²å…¥ä»»å‹™è©³æƒ…é 
2. åˆ‡æ›åˆ°ã€ŒOCR çµæœã€æ¨™ç±¤
3. æŸ¥çœ‹æ¯å€‹æª”æ¡ˆæå–çš„é—œéµå­—
4. é»æ“Šã€ŒæŸ¥çœ‹åŸåœ–ã€å°æ¯”ç¢ºèª

**å¦‚æœæå–ä¸æº–ç¢º**:
- æª¢æŸ¥ç›®æ¨™é é¢æ˜¯å¦æ­£ç¢º
- èª¿æ•´ OCR åƒæ•¸
- é‡æ–°é…ç½®é—œéµå­—

### å ´æ™¯ 4ï¼šåŒ¯å‡ºå‰é è¦½

**ç›®çš„**: åœ¨åŒ¯å‡º Excel å‰å…ˆé è¦½çµæœ

**æ­¥é©Ÿ**:
1. é€²å…¥ä»»å‹™è©³æƒ…é 
2. æŸ¥çœ‹ã€ŒOCR çµæœã€æ¨™ç±¤
3. ç¢ºèªé—œéµå­—æå–å®Œæ•´
4. è¿”å›ä»»å‹™åˆ—è¡¨é é¢
5. é»æ“Šã€ŒåŒ¯å‡º Excelã€

## ğŸ”Œ API ç«¯é»

### å–å¾—æª”æ¡ˆè©³æƒ…
```http
GET /api/batch-tasks/{task_id}/files/{file_id}
```

**å›æ‡‰**:
```json
{
  "success": true,
  "file": {
    "id": 1,
    "file_name": "document_001.pdf",
    "matched_page_number": 5,
    "matching_score": 0.8532,
    "stage1_status": "completed",
    "stage2_status": "completed",
    "extracted_keywords": {
      "è£½ä½œæ—¥æœŸ": "2007/04/10",
      "å ±å‘Šç·¨è™Ÿ": "A123-456"
    }
  }
}
```

### å–å¾—åŒ¹é…é é¢åœ–ç‰‡
```http
GET /api/batch-tasks/{task_id}/files/{file_id}/image
```

**å›æ‡‰**: PNG åœ–ç‰‡ï¼ˆäºŒé€²åˆ¶è³‡æ–™ï¼‰

### å–å¾—ä»»å‹™é è¦½
```http
GET /api/batch-tasks/{task_id}/preview?limit=10
```

**å›æ‡‰**:
```json
{
  "success": true,
  "files": [
    {
      "id": 1,
      "file_name": "document_001.pdf",
      "matched_page_number": 5,
      "matching_score": 0.8532,
      "stage2_status": "completed",
      "has_image": true
    }
  ]
}
```

## ğŸ’¡ ä½¿ç”¨æŠ€å·§

### æŠ€å·§ 1ï¼šå¿«é€Ÿå®šä½å•é¡Œæª”æ¡ˆ

1. é€²å…¥ã€Œæª”æ¡ˆåˆ—è¡¨ã€æ¨™ç±¤
2. æŸ¥çœ‹åŒ¹é…åˆ†æ•¸æ¬„ä½
3. åŒ¹é…åˆ†æ•¸ < 0.5 çš„æª”æ¡ˆå¯èƒ½æœ‰å•é¡Œ
4. é»æ“Šã€ŒæŸ¥çœ‹åœ–ç‰‡ã€ç¢ºèª

### æŠ€å·§ 2ï¼šæ‰¹é‡é©—è­‰çµæœ

1. åœ¨ã€Œåœ–ç‰‡é è¦½ã€æ¨™ç±¤æŸ¥çœ‹æ‰€æœ‰ç¸®åœ–
2. å¿«é€Ÿç€è¦½ç¢ºèªé é¢é¡å‹æ˜¯å¦ä¸€è‡´
3. é»æ“Šç•°å¸¸çš„åœ–ç‰‡æŸ¥çœ‹è©³æƒ…

### æŠ€å·§ 3ï¼šå°æ¯”åŸå§‹æª”æ¡ˆ

1. è¨˜ä¸‹æª”æ¡ˆè·¯å¾‘ï¼ˆé¡¯ç¤ºåœ¨åœ–ç‰‡æŸ¥çœ‹å™¨ä¸­ï¼‰
2. åœ¨æª”æ¡ˆç³»çµ±ä¸­é–‹å•ŸåŸå§‹ PDF
3. å°æ¯”ç¢ºèªåŒ¹é…é ç¢¼æ˜¯å¦æ­£ç¢º

### æŠ€å·§ 4ï¼šè¿½è¹¤é—œéµå­—æå–ç‡

1. åœ¨ã€ŒOCR çµæœã€æ¨™ç±¤æŸ¥çœ‹
2. çµ±è¨ˆæœ‰å¤šå°‘æª”æ¡ˆæˆåŠŸæå–æ‰€æœ‰é—œéµå­—
3. æ‰¾å‡ºæœªæ‰¾åˆ°çš„é—œéµå­—æ¨¡å¼
4. å„ªåŒ– LLM æç¤ºæˆ– OCR åƒæ•¸

## ğŸ› æ•…éšœæ’é™¤

### å•é¡Œ 1ï¼šåœ–ç‰‡ç„¡æ³•é¡¯ç¤º

**å¯èƒ½åŸå› **:
- ç¬¬ä¸€éšæ®µå°šæœªå®Œæˆ
- åœ–ç‰‡è³‡æ–™æå£
- ç¶²è·¯é€£æ¥å•é¡Œ

**è§£æ±ºæ–¹æ¡ˆ**:
1. ç¢ºèªç¬¬ä¸€éšæ®µå·²å®Œæˆ
2. æª¢æŸ¥ç€è¦½å™¨æ§åˆ¶å°éŒ¯èª¤
3. é‡æ–°æ•´ç†é é¢
4. å˜—è©¦åœ¨ç„¡ç—•æ¨¡å¼é–‹å•Ÿ

### å•é¡Œ 2ï¼šè©³æƒ…é é¢ç©ºç™½

**å¯èƒ½åŸå› **:
- ä»»å‹™ ID ä¸å­˜åœ¨
- è³‡æ–™åº«é€£æ¥å•é¡Œ
- JavaScript éŒ¯èª¤

**è§£æ±ºæ–¹æ¡ˆ**:
1. ç¢ºèªä»»å‹™ ID æ­£ç¢º
2. æª¢æŸ¥ç€è¦½å™¨æ§åˆ¶å°
3. ç¢ºèªæœå‹™æ­£å¸¸é‹è¡Œ
4. æ¸…é™¤ç€è¦½å™¨å¿«å–

### å•é¡Œ 3ï¼šOCR çµæœæ¨™ç±¤ç‚ºç©º

**å¯èƒ½åŸå› **:
- ç¬¬äºŒéšæ®µå°šæœªå®Œæˆ
- æ²’æœ‰é…ç½®é—œéµå­—
- é—œéµå­—æå–å¤±æ•—

**è§£æ±ºæ–¹æ¡ˆ**:
1. ç¢ºèªç¬¬äºŒéšæ®µå·²å®Œæˆ
2. æŸ¥çœ‹ã€Œæª”æ¡ˆåˆ—è¡¨ã€ç¢ºèª stage2_status
3. æª¢æŸ¥ä»»å‹™é…ç½®æ˜¯å¦æœ‰é—œéµå­—
4. æŸ¥çœ‹å¤±æ•—æª”æ¡ˆçš„éŒ¯èª¤è¨Šæ¯

## ğŸ“ˆ æ•ˆèƒ½å„ªåŒ–

### åœ–ç‰‡è¼‰å…¥å„ªåŒ–

ç³»çµ±å·²å¯¦ç¾ï¼š
- **æ‡¶è¼‰å…¥**: åƒ…è¼‰å…¥ç•¶å‰é é¢çš„åœ–ç‰‡
- **é™åˆ¶æ•¸é‡**: é è¨­æ¯æ¬¡é¡¯ç¤º 12 å€‹æª”æ¡ˆ
- **éŒ¯èª¤è™•ç†**: è¼‰å…¥å¤±æ•—é¡¯ç¤ºä½”ä½ç¬¦

### è³‡æ–™æŸ¥è©¢å„ªåŒ–

- ä½¿ç”¨åˆ†é æŸ¥è©¢é¿å…ä¸€æ¬¡è¼‰å…¥éå¤šè³‡æ–™
- åƒ…åœ¨åˆ‡æ›æ¨™ç±¤æ™‚è¼‰å…¥å°æ‡‰è³‡æ–™
- è³‡æ–™åº«æŸ¥è©¢ä½¿ç”¨ç´¢å¼•åŠ é€Ÿ

### å»ºè­°è¨­å®š

å°æ–¼å¤§å‹ä»»å‹™ï¼ˆ> 100 å€‹æª”æ¡ˆï¼‰ï¼š
- å¢åŠ åˆ†é å¤§å°ä»¥æ¸›å°‘è«‹æ±‚æ¬¡æ•¸
- ä½¿ç”¨ã€Œæª”æ¡ˆåˆ—è¡¨ã€æ¨™ç±¤è€Œéåœ–ç‰‡é è¦½
- è€ƒæ…®åˆ†æ‰¹è™•ç†ä»»å‹™

## ğŸ“ é€²éšåŠŸèƒ½

### è‡ªè¨‚é¡¯ç¤ºæ•¸é‡

ä¿®æ”¹ JavaScript ä¸­çš„ `filesPerPage` è®Šæ•¸ï¼š
```javascript
const filesPerPage = 20;  // é è¨­æ˜¯ 12
```

### åŒ¯å‡ºç‰¹å®šæª”æ¡ˆ

åœ¨ã€Œæª”æ¡ˆåˆ—è¡¨ã€æ¨™ç±¤ï¼š
1. è¨˜ä¸‹éœ€è¦çš„æª”æ¡ˆ ID
2. ä½¿ç”¨ API ç›´æ¥ç²å–è©²æª”æ¡ˆè³‡æ–™
3. è‡ªè¡Œè™•ç†å’ŒåŒ¯å‡º

### æ‰¹é‡ä¸‹è¼‰åœ–ç‰‡

ä½¿ç”¨è…³æœ¬æ‰¹é‡ä¸‹è¼‰æ‰€æœ‰åŒ¹é…é é¢ï¼š
```python
import requests

task_id = "your-task-id"
files = requests.get(f"http://localhost:8080/api/batch-tasks/{task_id}/preview?limit=100").json()

for file in files['files']:
    file_id = file['id']
    img_data = requests.get(f"http://localhost:8080/api/batch-tasks/{task_id}/files/{file_id}/image").content
    with open(f"page_{file_id}.png", 'wb') as f:
        f.write(img_data)
```

## ğŸ‰ ç¸½çµ

æ–°çš„è™•ç†ç‹€æ…‹æŸ¥çœ‹åŠŸèƒ½è®“æ‚¨èƒ½å¤ ï¼š
- âœ… å³æ™‚æŸ¥çœ‹æ¯å€‹æª”æ¡ˆçš„è™•ç†çµæœ
- âœ… å¿«é€Ÿé©—è­‰ CLIP åŒ¹é…çš„æº–ç¢ºæ€§
- âœ… é è¦½ OCR æå–çš„é—œéµå­—
- âœ… åœ¨åŒ¯å‡ºå‰ç¢ºèªè³‡æ–™æ­£ç¢ºæ€§
- âœ… è¿½è¹¤ä»»å‹™è™•ç†é€²åº¦

ç¾åœ¨æ‚¨å¯ä»¥æ›´æœ‰ä¿¡å¿ƒåœ°ä½¿ç”¨æ‰¹æ¬¡ä»»å‹™ç®¡ç†ç³»çµ±è™•ç†å¤§é‡æ–‡ä»¶ï¼
